<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="6.2 EQL: The EMU Query Language version 2 | The EMU-SDMS Manual" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://ips-lmu.github.io/The-EMU-SDMS-Manual/" />
<meta property="og:image" content="https://ips-lmu.github.io/The-EMU-SDMS-Manual/pics/EMU-webAppIcon-roundCorners.png" />
<meta property="og:description" content="6.2 EQL: The EMU Query Language version 2 | The EMU-SDMS Manual" />
<meta name="github-repo" content="IPS-LMU/The-EMU-SDMS-Manual" />

<meta name="author" content="Raphael Winkelmann" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="6.2 EQL: The EMU Query Language version 2 | The EMU-SDMS Manual">

<title>6.2 EQL: The EMU Query Language version 2 | The EMU-SDMS Manual</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/darkly.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="style.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#welcome">Welcome</a></li>
<li class="has-sub"><a href="1-installing-the-emu-sdms.html#installing-the-emu-sdms"><span class="toc-section-number">1</span> Installing the EMU-SDMS</a><ul>
<li><a href="1-1-version-disclaimer.html#version-disclaimer"><span class="toc-section-number">1.1</span> Version disclaimer</a></li>
<li><a href="1-2-for-developers-and-people-interested-in-the-source-code.html#for-developers-and-people-interested-in-the-source-code"><span class="toc-section-number">1.2</span> For developers and people interested in the source code</a></li>
</ul></li>
<li class="part"><span><b>I Overview and tutorial</b></span></li>
<li class="has-sub"><a href="2-chap-overview.html#chap:overview"><span class="toc-section-number">2</span> An overview of the EMU-SDMS</a><ul>
<li><a href="2-1-the-evolution-of-the-emu-sdms.html#the-evolution-of-the-emu-sdms"><span class="toc-section-number">2.1</span> The evolution of the EMU-SDMS</a></li>
<li><a href="2-2-sec-overview-sysArch.html#sec:overview-sysArch"><span class="toc-section-number">2.2</span> EMU-SDMS: System architecture and default workflow</a></li>
<li><a href="2-3-emu-sdms-is-it-something-for-you.html#emu-sdms-is-it-something-for-you"><span class="toc-section-number">2.3</span> EMU-SDMS: Is it something for you?</a></li>
</ul></li>
<li class="has-sub"><a href="3-chap-tutorial.html#chap:tutorial"><span class="toc-section-number">3</span> A tutorial on how to use the EMU-SDMS</a><ul>
<li><a href="3-1-converting-the-textgrid-collection.html#converting-the-textgrid-collection"><span class="toc-section-number">3.1</span> Converting the TextGrid collection</a></li>
<li class="has-sub"><a href="3-2-loading-and-inspecting-the-database.html#loading-and-inspecting-the-database"><span class="toc-section-number">3.2</span> Loading and inspecting the database</a><ul>
<li><a href="3-2-loading-and-inspecting-the-database.html#overview"><span class="toc-section-number">3.2.1</span> Overview</a></li>
<li><a href="3-2-loading-and-inspecting-the-database.html#database-annotation-and-visual-inspection"><span class="toc-section-number">3.2.2</span> Database annotation and visual inspection</a></li>
</ul></li>
<li><a href="3-3-querying-and-autobuilding-the-annotation-structure.html#querying-and-autobuilding-the-annotation-structure"><span class="toc-section-number">3.3</span> Querying and autobuilding the annotation structure</a></li>
<li class="has-sub"><a href="3-4-autobuilding.html#autobuilding"><span class="toc-section-number">3.4</span> Autobuilding</a><ul>
<li><a href="3-4-autobuilding.html#querying-the-hierarchical-annotations"><span class="toc-section-number">3.4.1</span> Querying the hierarchical annotations</a></li>
</ul></li>
<li><a href="3-5-section-tutorial-sigExtrAndExpl.html#section:tutorial-sigExtrAndExpl"><span class="toc-section-number">3.5</span> Signal extraction and exploration</a></li>
<li><a href="3-6-vowel-height-as-a-function-of-word-types-content-vs-function-evaluation-and-statistical-analysis.html#vowel-height-as-a-function-of-word-types-content-vs.-function-evaluation-and-statistical-analysis"><span class="toc-section-number">3.6</span> Vowel height as a function of word types (content vs.Â function): evaluation and statistical analysis</a></li>
<li><a href="3-7-conclusion.html#conclusion"><span class="toc-section-number">3.7</span> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>II Main components and concepts</b></span></li>
<li class="has-sub"><a href="4-chap-annot-struct-mod.html#chap:annot-struct-mod"><span class="toc-section-number">4</span> Annotation Structure Modeling</a><ul>
<li><a href="4-1-per-database-annotation-structure-definition.html#per-database-annotation-structure-definition"><span class="toc-section-number">4.1</span> Per database annotation structure definition</a></li>
<li><a href="4-2-parallel-labels-and-multiple-attributes.html#parallel-labels-and-multiple-attributes"><span class="toc-section-number">4.2</span> Parallel labels and multiple attributes</a></li>
<li><a href="4-3-metadata-strategy-using-single-bundle-root-nodes.html#metadata-strategy-using-single-bundle-root-nodes"><span class="toc-section-number">4.3</span> Metadata strategy using single bundle root nodes</a></li>
<li><a href="4-4-conclusion-1.html#conclusion-1"><span class="toc-section-number">4.4</span> Conclusion</a></li>
</ul></li>
<li class="has-sub"><a href="5-chap-emuDB.html#chap:emuDB"><span class="toc-section-number">5</span> The <code>emuDB</code> Format</a><ul>
<li><a href="5-1-database-design.html#database-design"><span class="toc-section-number">5.1</span> Database design</a></li>
<li class="has-sub"><a href="5-2-creating-an-emudb.html#creating-an-emudb"><span class="toc-section-number">5.2</span> Creating an <code>emuDB</code></a><ul>
<li><a href="5-2-creating-an-emudb.html#creating-an-emudb-from-scratch"><span class="toc-section-number">5.2.1</span> Creating an <code>emuDB</code> from scratch</a></li>
<li><a href="5-2-creating-an-emudb.html#loading-and-editing-an-empty-database"><span class="toc-section-number">5.2.2</span> Loading and editing an empty database</a></li>
<li><a href="5-2-creating-an-emudb.html#level-definitions"><span class="toc-section-number">5.2.3</span> Level definitions</a></li>
<li><a href="5-2-creating-an-emudb.html#link-definitions"><span class="toc-section-number">5.2.4</span> Link definitions</a></li>
<li><a href="5-2-creating-an-emudb.html#file-handling"><span class="toc-section-number">5.2.5</span> File handling</a></li>
<li><a href="5-2-creating-an-emudb.html#ssff-track-definitions"><span class="toc-section-number">5.2.6</span> SSFF track definitions</a></li>
<li><a href="5-2-creating-an-emudb.html#configuring-the-emu-webapp-and-annotating-the-emudb"><span class="toc-section-number">5.2.7</span> Configuring the <code>EMU-webApp</code> and annotating the <code>emuDB</code></a></li>
</ul></li>
<li><a href="5-3-conclusion-2.html#conclusion-2"><span class="toc-section-number">5.3</span> Conclusion</a></li>
</ul></li>
<li class="has-sub"><a href="6-chap-querysys.html#chap:querysys"><span class="toc-section-number">6</span> The query system</a><ul>
<li><a href="6-1-sec-query-emuRsegs.html#sec:query-emuRsegs"><span class="toc-section-number">6.1</span> The resulting object of a query</a></li>
<li class="has-sub"><a href="6-2-eql-the-emu-query-language-version-2.html#eql-the-emu-query-language-version-2"><span class="toc-section-number">6.2</span> <code>EQL</code>: The EMU Query Language version 2</a><ul>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#simple-queries"><span class="toc-section-number">6.2.1</span> Simple queries</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#combining-simple-queries"><span class="toc-section-number">6.2.2</span> Combining simple queries</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#subsec:query-positionQueries"><span class="toc-section-number">6.2.3</span> Position queries</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#subsec:query-countQueries"><span class="toc-section-number">6.2.4</span> Count queries</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#subsec:query-moreComplexQueries"><span class="toc-section-number">6.2.5</span> More complex queries</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#subsec:query-deducingTime"><span class="toc-section-number">6.2.6</span> Deducing time</a></li>
<li><a href="6-2-eql-the-emu-query-language-version-2.html#subsec:requery"><span class="toc-section-number">6.2.7</span> Requery</a></li>
</ul></li>
<li><a href="6-3-discussion.html#discussion"><span class="toc-section-number">6.3</span> Discussion</a></li>
</ul></li>
<li class="has-sub"><a href="7-chap-sigDataExtr.html#chap:sigDataExtr"><span class="toc-section-number">7</span> Signal data extraction</a><ul>
<li><a href="7-1-extracting-pre-defined-tracks.html#extracting-pre-defined-tracks"><span class="toc-section-number">7.1</span> Extracting pre-defined tracks</a></li>
<li><a href="7-2-adding-new-tracks.html#adding-new-tracks"><span class="toc-section-number">7.2</span> Adding new tracks</a></li>
<li><a href="7-3-calculating-tracks-on-the-fly.html#calculating-tracks-on-the-fly"><span class="toc-section-number">7.3</span> Calculating tracks on-the-fly</a></li>
<li><a href="7-4-the-resulting-object-tibble.html#the-resulting-object-tibble"><span class="toc-section-number">7.4</span> The resulting object: <code>tibble</code></a></li>
<li><a href="7-5-conclusion-3.html#conclusion-3"><span class="toc-section-number">7.5</span> Conclusion</a></li>
</ul></li>
<li class="has-sub"><a href="8-chap-wrassp.html#chap:wrassp"><span class="toc-section-number">8</span> The R package <code>wrassp</code></a><ul>
<li><a href="8-1-introduction.html#introduction"><span class="toc-section-number">8.1</span> Introduction</a></li>
<li><a href="8-2-file-i0-and-the-asspdataobj.html#file-i0-and-the-asspdataobj"><span class="toc-section-number">8.2</span> File I/0 and the <code>AsspDataObj</code></a></li>
<li><a href="8-3-signal-processing.html#signal-processing"><span class="toc-section-number">8.3</span> Signal processing</a></li>
<li><a href="8-4-subsec-wrassp-wrasspOutputInfos.html#subsec:wrassp-wrasspOutputInfos"><span class="toc-section-number">8.4</span> The <code>wrasspOutputInfos</code> object</a></li>
<li class="has-sub"><a href="8-5-subsec-wrassp-formants.html#subsec:wrassp-formants"><span class="toc-section-number">8.5</span> Formants and their bandwidths</a><ul>
<li><a href="8-5-subsec-wrassp-formants.html#subsec:wrassp-f0"><span class="toc-section-number">8.5.1</span> Fundamental frequency contour</a></li>
<li><a href="8-5-subsec-wrassp-formants.html#subsec:wrassp-RMS"><span class="toc-section-number">8.5.2</span> RMS energy contour</a></li>
</ul></li>
<li><a href="8-6-sec-wrassp-logging.html#sec:wrassp-logging"><span class="toc-section-number">8.6</span> Logging <code>wrassp</code>âs function calls</a></li>
<li><a href="8-7-sec-wrassp-emu-sdms.html#sec:wrassp-emu-sdms"><span class="toc-section-number">8.7</span> Using <code>wrassp</code> in the EMU-SDMS</a></li>
<li><a href="8-8-sec-wrassp-genSSFF.html#sec:wrassp-genSSFF"><span class="toc-section-number">8.8</span> Storing data in the SSFF file format</a></li>
<li><a href="8-9-conclusion-4.html#conclusion-4"><span class="toc-section-number">8.9</span> Conclusion</a></li>
</ul></li>
<li class="has-sub"><a href="9-chap-emu-webApp.html#chap:emu-webApp"><span class="toc-section-number">9</span> The <code>EMU-webApp</code></a><ul>
<li><a href="9-1-sec-emu-webApp-mainLayout.html#sec:emu-webApp-mainLayout"><span class="toc-section-number">9.1</span> Main layout</a></li>
<li class="has-sub"><a href="9-2-sec-webApp-generalUsage.html#sec:webApp-generalUsage"><span class="toc-section-number">9.2</span> General usage</a><ul>
<li><a href="9-2-sec-webApp-generalUsage.html#annotating-levels-containing-time-information"><span class="toc-section-number">9.2.1</span> Annotating levels containing time information</a></li>
<li><a href="9-2-sec-webApp-generalUsage.html#working-with-hierarchical-annotations-2-chapemu-webapp"><span class="toc-section-number">9.2.2</span> Working with hierarchical annotations</a></li>
</ul></li>
<li class="has-sub"><a href="9-3-configuring-the-emu-webapp.html#configuring-the-emu-webapp"><span class="toc-section-number">9.3</span> Configuring the <code>EMU-webApp</code></a><ul>
<li><a href="9-3-configuring-the-emu-webapp.html#subsec:emu-webAppConfigWithEmuR"><span class="toc-section-number">9.3.1</span> Basic configurations using <code>emuR</code></a></li>
<li><a href="9-3-configuring-the-emu-webapp.html#signal-canvas-and-level-canvas-order"><span class="toc-section-number">9.3.2</span> Signal canvas and level canvas order</a></li>
<li><a href="9-3-configuring-the-emu-webapp.html#subsec:emu-webAppAdvancedConfig"><span class="toc-section-number">9.3.3</span> Advanced configurations made by editing the <code>_DBconfig.json</code></a></li>
<li><a href="9-3-configuring-the-emu-webapp.html#d-canvas"><span class="toc-section-number">9.3.4</span> 2D canvas</a></li>
</ul></li>
<li><a href="9-4-conclusion-5.html#conclusion-5"><span class="toc-section-number">9.4</span> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>III Main <code>emuR</code> function and object index</b></span></li>
<li class="has-sub"><a href="10-chap-emuRpackageDetails.html#chap:emuRpackageDetails"><span class="toc-section-number">10</span> <code>emuR</code> - package functions</a><ul>
<li class="has-sub"><a href="10-1-sec-emuRpackageDetails-importRoutines.html#sec:emuRpackageDetails-importRoutines"><span class="toc-section-number">10.1</span> Import and conversion routines</a><ul>
<li><a href="10-1-sec-emuRpackageDetails-importRoutines.html#legacy-emu-databases"><span class="toc-section-number">10.1.1</span> Legacy EMU databases</a></li>
<li><a href="10-1-sec-emuRpackageDetails-importRoutines.html#textgrid-collections"><span class="toc-section-number">10.1.2</span> TextGrid collections</a></li>
<li><a href="10-1-sec-emuRpackageDetails-importRoutines.html#bpf-collections"><span class="toc-section-number">10.1.3</span> BPF collections</a></li>
<li><a href="10-1-sec-emuRpackageDetails-importRoutines.html#txt-collections"><span class="toc-section-number">10.1.4</span> txt collections</a></li>
</ul></li>
<li><a href="10-2-sec-emuRpackageDetails-emuDBinteract.html#sec:emuRpackageDetails-emuDBinteract"><span class="toc-section-number">10.2</span> <code>emuDB</code> interaction and configuration routines</a></li>
<li><a href="10-3-sec-emuRpackageDetails-emuWebAppConfig.html#sec:emuRpackageDetails-emuWebAppConfig"><span class="toc-section-number">10.3</span> <code>EMU-webApp</code> configuration routines</a></li>
<li><a href="10-4-sec-emuRpackageDetails-dataExtr.html#sec:emuRpackageDetails-dataExtr"><span class="toc-section-number">10.4</span> Data extraction routines</a></li>
<li><a href="10-5-sec-emuRpackageDetails-centralObjects.html#sec:emuRpackageDetails-centralObjects"><span class="toc-section-number">10.5</span> Central objects</a></li>
<li><a href="10-6-sec-emuRpackageDetails-exportRoutines.html#sec:emuRpackageDetails-exportRoutines"><span class="toc-section-number">10.6</span> Export routines</a></li>
<li><a href="10-7-conclusion-6.html#conclusion-6"><span class="toc-section-number">10.7</span> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>IV Implementation</b></span></li>
<li class="has-sub"><a href="11-chap-querysys-impl.html#chap:querysys-impl"><span class="toc-section-number">11</span> Implementation of the query system</a><ul>
<li><a href="11-1-sec-query-queryExpressionParser.html#sec:query-queryExpressionParser"><span class="toc-section-number">11.1</span> Query expression parser</a></li>
<li><a href="11-2-subsec-query-redundantLinks.html#subsec:query-redundantLinks"><span class="toc-section-number">11.2</span> Redundant links</a></li>
</ul></li>
<li class="has-sub"><a href="12-chap-wrassp-impl.html#chap:wrassp_impl"><span class="toc-section-number">12</span> <code>wrassp</code> implementation</a><ul>
<li><a href="12-1-the-libassp-port.html#the-libassp-port"><span class="toc-section-number">12.1</span> The <code>libassp</code> port</a></li>
</ul></li>
<li class="has-sub"><a href="13-chap-emu-webAppImplementation.html#chap:emu-webAppImplementation"><span class="toc-section-number">13</span> <code>EMU-webApp</code> implementation</a><ul>
<li><a href="13-1-subsec-emu-webAppTheProtocol.html#subsec:emu-webAppTheProtocol"><span class="toc-section-number">13.1</span> Communication protocol</a></li>
<li class="has-sub"><a href="13-2-url-parameters.html#url-parameters"><span class="toc-section-number">13.2</span> URL parameters</a><ul>
<li><a href="13-2-url-parameters.html#websocket-server-parameters"><span class="toc-section-number">13.2.1</span> Websocket server parameters</a></li>
<li><a href="13-2-url-parameters.html#examples"><span class="toc-section-number">13.2.2</span> Examples</a></li>
<li><a href="13-2-url-parameters.html#label-file-preview-parameters"><span class="toc-section-number">13.2.3</span> Label file preview parameters</a></li>
<li><a href="13-2-url-parameters.html#examples-1"><span class="toc-section-number">13.2.4</span> Examples</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Appendices</b></span></li>
<li class="has-sub"><a href="14-app-chap-useCases.html#app-chap:useCases"><span class="toc-section-number">14</span> Use cases</a><ul>
<li><a href="14-1-sec-app-chap-useCases-q1.html#sec:app-chap-useCases-q1"><span class="toc-section-number">14.1</span> What is the average length of all <em>n</em> phonetic segments in the <em>ae</em> <code>emuDB</code>?</a></li>
<li><a href="14-2-sec-app-chap-useCases-q2.html#sec:app-chap-useCases-q2"><span class="toc-section-number">14.2</span> What does the F1 and F2 distribution of all phonetic segments that contain the labels <em>I</em>, <em>o:</em>, <em>u:</em>, <em>V</em> or <em>@</em> look like?</a></li>
<li><a href="14-3-sec-app-chap-useCases-q3.html#sec:app-chap-useCases-q3"><span class="toc-section-number">14.3</span> What words do the phonetic segments that carry the labels <em>s</em>, <em>z</em>, <em>S</em> or <em>Z</em> in the <em>ae</em> <code>emuDB</code> occur in and what is their phonetic context?</a></li>
<li class="has-sub"><a href="14-4-sec-app-chap-useCases-q4.html#sec:app-chap-useCases-q4"><span class="toc-section-number">14.4</span> Do the phonetic segments labeled <em>s</em>, <em>z</em>, <em>S</em> or <em>Z</em> in the <em>ae</em> <code>emuDB</code> differ with respect to their first spectral moment?\footnote{The original version of this use case was written by Florian Schiel as part of the <code>emuR_intro</code> vignette that is part of the <code>emuR</code> package.</a><ul>
<li><a href="14-4-sec-app-chap-useCases-q4.html#note-see-refrecipespectralanalysis-for-more-up-to-date-methods-of-performing-spectral-analysis"><span class="toc-section-number">14.4.1</span> NOTE: See @ref(recipe:spectralAnalysis) for more up to date methods of performing spectral analysis</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="15-app-chap-fileFormats.html#app-chap:fileFormats"><span class="toc-section-number">15</span> File Formats</a><ul>
<li class="has-sub"><a href="15-1-file-descriptions.html#file-descriptions"><span class="toc-section-number">15.1</span> File descriptions</a><ul>
<li><a href="15-1-file-descriptions.html#subsec:app-chapFileFormatsDBconfig"><span class="toc-section-number">15.1.1</span> <code>_DBconfig.json</code></a></li>
<li><a href="15-1-file-descriptions.html#subsec:app-chapFileFormatsAnnotJSON"><span class="toc-section-number">15.1.2</span> <code>_annot.json</code></a></li>
<li><a href="15-1-file-descriptions.html#subsec:app-chapFileFormatsSSFF"><span class="toc-section-number">15.1.3</span> The SSFF file format</a></li>
</ul></li>
<li class="has-sub"><a href="15-2-example-files.html#example-files"><span class="toc-section-number">15.2</span> Example files</a><ul>
<li><a href="15-2-example-files.html#subsec:app-chapExampleFilesBundleList"><span class="toc-section-number">15.2.1</span> <code>_bundleList.json</code></a></li>
<li><a href="15-2-example-files.html#subsec:app-chapExampleFilesBndlJSON"><span class="toc-section-number">15.2.2</span> <code>_bndl.json</code></a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="16-app-chap-wsProtocol.html#app-chap:wsProtocol"><span class="toc-section-number">16</span> The <code>EMU-webApp-websocket-protocol</code> Version 2.0</a><ul>
<li><a href="16-1-protocol-overview.html#protocol-overview"><span class="toc-section-number">16.1</span> Protocol overview</a></li>
<li class="has-sub"><a href="16-2-protocol-commands.html#protocol-commands"><span class="toc-section-number">16.2</span> Protocol commands</a><ul>
<li><a href="16-2-protocol-commands.html#getprotocol"><span class="toc-section-number">16.2.1</span> <code>GETPROTOCOL</code></a></li>
<li><a href="16-2-protocol-commands.html#getdousermanagement"><span class="toc-section-number">16.2.2</span> <code>GETDOUSERMANAGEMENT</code></a></li>
<li><a href="16-2-protocol-commands.html#logonuser"><span class="toc-section-number">16.2.3</span> <code>LOGONUSER</code></a></li>
<li><a href="16-2-protocol-commands.html#getglobaldbconfig"><span class="toc-section-number">16.2.4</span> <code>GETGLOBALDBCONFIG</code></a></li>
<li><a href="16-2-protocol-commands.html#getbundlelist"><span class="toc-section-number">16.2.5</span> <code>GETBUNDLELIST</code></a></li>
<li><a href="16-2-protocol-commands.html#getbundle"><span class="toc-section-number">16.2.6</span> <code>GETBUNDLE</code></a></li>
<li><a href="16-2-protocol-commands.html#savebundle"><span class="toc-section-number">16.2.7</span> <code>SAVEBUNDLE</code></a></li>
<li><a href="16-2-protocol-commands.html#disconnectwarning"><span class="toc-section-number">16.2.8</span> <code>DISCONNECTWARNING</code></a></li>
<li><a href="16-2-protocol-commands.html#error-handling"><span class="toc-section-number">16.2.9</span> Error handling</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="17-app-chap-EQL-EBNF.html#app-chap:EQL-EBNF"><span class="toc-section-number">17</span> EQL EBNF</a><ul>
<li><a href="17-1-terminal-symbols-of-eql2-operators-and-their-meaning.html#terminal-symbols-of-eql2-operators-and-their-meaning"><span class="toc-section-number">17.1</span> Terminal symbols of EQL2 (operators) and their meaning</a></li>
<li><a href="17-2-terminal-symbols-of-eql2-brackets-and-their-meanings-.html#terminal-symbols-of-eql2-brackets-and-their-meanings."><span class="toc-section-number">17.2</span> Terminal symbols of EQL2 (brackets) and their meanings.</a></li>
<li><a href="17-3-terminal-symbols-of-eql2-functions-and-their-meanings-.html#terminal-symbols-of-eql2-functions-and-their-meanings."><span class="toc-section-number">17.3</span> Terminal symbols of EQL2 (functions) and their meanings.</a></li>
<li><a href="17-4-formal-description-of-emu-query-language-version-2.html#formal-description-of-emu-query-language-version-2"><span class="toc-section-number">17.4</span> Formal description of EMU Query Language Version 2</a></li>
<li><a href="17-5-restrictions.html#restrictions"><span class="toc-section-number">17.5</span> Restrictions</a></li>
</ul></li>
<li class="has-sub"><a href="18-app-chap-eql.html#app-chap:eql"><span class="toc-section-number">18</span> EQL: further examples</a><ul>
<li><a href="18-1-simple-equality-inequality-matching-non-matching-queries-single-argument.html#simple-equality-inequality-matching-non-matching-queries-single-argument"><span class="toc-section-number">18.1</span> Simple equality, inequality, matching and non-matching queries (single-argument)</a></li>
<li><a href="18-2-sequence-queries-using-the-sequence-operator.html#sequence-queries-using-the---sequence-operator"><span class="toc-section-number">18.2</span> Sequence queries using the -&gt; sequence operator</a></li>
<li><a href="18-3-subsequent-sequence-queries-using-nesting-of-the-sequence-operator.html#subsequent-sequence-queries-using-nesting-of-the---sequence-operator"><span class="toc-section-number">18.3</span> Subsequent sequence queries using nesting of the <code>-&gt;</code> sequence operator</a></li>
<li><a href="18-4-conjunction-operator.html#conjunction-operator"><span class="toc-section-number">18.4</span> Conjunction operator &amp;</a></li>
<li class="has-sub"><a href="18-5-domination-operator-hierarchical-queries.html#domination-operator-hierarchical-queries"><span class="toc-section-number">18.5</span> Domination operator ^ (hierarchical queries)</a><ul>
<li><a href="18-5-domination-operator-hierarchical-queries.html#simple-domination"><span class="toc-section-number">18.5.1</span> Simple domination</a></li>
<li><a href="18-5-domination-operator-hierarchical-queries.html#multiple-domination"><span class="toc-section-number">18.5.2</span> Multiple domination</a></li>
</ul></li>
<li class="has-sub"><a href="18-6-position.html#position"><span class="toc-section-number">18.6</span> Position</a><ul>
<li><a href="18-6-position.html#simple-usage-of-start-end-and-medial"><span class="toc-section-number">18.6.1</span> Simple usage of <code>Start()</code>, <code>End()</code> and <code>Medial()</code></a></li>
<li><a href="18-6-position.html#position-and-boolean"><span class="toc-section-number">18.6.2</span> Position and boolean &amp;</a></li>
<li><a href="18-6-position.html#position-and-boolean-1"><span class="toc-section-number">18.6.3</span> Position and boolean ^</a></li>
<li><a href="18-6-position.html#count-and-boolean"><span class="toc-section-number">18.6.4</span> Count and boolean <code>&amp;</code></a></li>
<li><a href="18-6-position.html#count-and"><span class="toc-section-number">18.6.5</span> Count and ^</a></li>
</ul></li>
<li class="has-sub"><a href="18-7-combinations.html#combinations"><span class="toc-section-number">18.7</span> Combinations</a><ul>
<li><a href="18-7-combinations.html#and---domination-and-sequence"><span class="toc-section-number">18.7.1</span> ^ and -&gt; (domination and sequence)</a></li>
<li><a href="18-7-combinations.html#and---and-domination-and-sequence-and-boolean"><span class="toc-section-number">18.7.2</span> ^ and -&gt; and &amp; (domination and sequence and boolean &amp;)</a></li>
</ul></li>
<li><a href="18-8-a-few-more-questions-and-answers.html#a-few-more-questions-and-answers"><span class="toc-section-number">18.8</span> A few more questions and answers</a></li>
<li class="has-sub"><a href="18-9-differences-to-the-legacy-emu-query-language.html#differences-to-the-legacy-emu-query-language"><span class="toc-section-number">18.9</span> Differences to the legacy EMU query language</a><ul>
<li><a href="18-9-differences-to-the-legacy-emu-query-language.html#function-call-syntax"><span class="toc-section-number">18.9.1</span> Function call syntax</a></li>
<li><a href="18-9-differences-to-the-legacy-emu-query-language.html#empty-result"><span class="toc-section-number">18.9.2</span> Empty result</a></li>
<li><a href="18-9-differences-to-the-legacy-emu-query-language.html#the-result-modifier-hash-tag"><span class="toc-section-number">18.9.3</span> The result modifier hash tag <code>#</code></a></li>
<li><a href="18-9-differences-to-the-legacy-emu-query-language.html#interpretation-of-the-hash-tag-in-conjunction-operator-queries"><span class="toc-section-number">18.9.4</span> Interpretation of the hash tag <code>#</code> in conjunction operator queries</a></li>
<li><a href="18-9-differences-to-the-legacy-emu-query-language.html#legacy-emu"><span class="toc-section-number">18.9.5</span> legacy EMU</a></li>
</ul></li>
<li class="has-sub"><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#bugs-in-legacy-emu-function-emu.query"><span class="toc-section-number">18.10</span> Bugs in legacy EMU function <code>emu.query()</code></a><ul>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#alternative-labels-in-inequality-queries"><span class="toc-section-number">18.10.1</span> Alternative labels in inequality queries</a></li>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#legacy-emu-1"><span class="toc-section-number">18.10.2</span> legacy EMU</a></li>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#emur-1"><span class="toc-section-number">18.10.3</span> emuR</a></li>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#errors-caused-by-missing-or-superfluous-blanks-or-parentheses"><span class="toc-section-number">18.10.4</span> Errors caused by missing or superfluous blanks or parentheses</a></li>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#order-of-result-segment-list"><span class="toc-section-number">18.10.5</span> Order of result segment list</a></li>
<li><a href="18-10-bugs-in-legacy-emu-function-emu-query.html#additional-features"><span class="toc-section-number">18.10.6</span> Additional features</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="19-app-chap-wrassp.html#app-chap:wrassp"><span class="toc-section-number">19</span> <code>wrassp</code></a><ul>
<li class="has-sub"><a href="19-1-sec-app-chap-wrassp-praatsSigProc.html#sec:app-chap-wrassp-praatsSigProc"><span class="toc-section-number">19.1</span> Using Praatâs signal processing routines in the EMU-SDMS</a><ul>
<li><a href="19-1-sec-app-chap-wrassp-praatsSigProc.html#to-formant-burg...-to-ssff-files"><span class="toc-section-number">19.1.1</span> <code>To Formant (burg)...</code> to SSFF files</a></li>
<li><a href="19-1-sec-app-chap-wrassp-praatsSigProc.html#to-pitch...-to-ssff-files"><span class="toc-section-number">19.1.2</span> <code>To Pitch...</code> to SSFF files</a></li>
</ul></li>
<li><a href="19-2-sec-app-chap-wrassp-opensmileSigProc.html#sec:app-chap-wrassp-opensmileSigProc"><span class="toc-section-number">19.2</span> Using OpenSMILE signal processing routines in the EMU-SDMS</a></li>
</ul></li>
<li class="part"><span><b>VI Recipes</b></span></li>
<li><a href="20-about.html#about"><span class="toc-section-number">20</span> About</a></li>
<li class="has-sub"><a href="21-recipe-spectralAnalysis.html#recipe:spectralAnalysis"><span class="toc-section-number">21</span> Spectral analysis</a><ul>
<li><a href="21-1-how-to-quantify-differences-between-spectra.html#how-to-quantify-differences-between-spectra"><span class="toc-section-number">21.1</span> How to quantify differences between spectra?</a></li>
<li><a href="21-2-discrete-cosine-transform-dct.html#discrete-cosine-transform-dct"><span class="toc-section-number">21.2</span> Discrete Cosine Transform (DCT)</a></li>
<li class="has-sub"><a href="21-3-dct-coefficients.html#dct-coefficients"><span class="toc-section-number">21.3</span> DCT coefficients</a><ul>
<li><a href="21-3-dct-coefficients.html#p.s.-use-dct-in-order-to-smooth-formant-trajectories"><span class="toc-section-number">21.3.1</span> P.S.: Use DCT in order to smooth formant trajectories</a></li>
</ul></li>
<li><a href="21-4-spectral-moments.html#spectral-moments"><span class="toc-section-number">21.4</span> Spectral moments</a></li>
</ul></li>
<li class="has-sub"><a href="22-recipe-plottingSnippets.html#recipe:plottingSnippets"><span class="toc-section-number">22</span> Plotting snippets</a><ul>
<li><a href="22-1-formant-trajectory-plots-equivalent-to-the-legacy-dplot-normalise-tf-average-tf-.html#formant-trajectory-plots-equivalent-to-the-legacy-dplot...-normalise-tf-average-tf..."><span class="toc-section-number">22.1</span> Formant trajectory plots (equivalent to the legacy <code>dplot(..., normalise = T/F, average = T/F,...)</code>)</a></li>
<li><a href="22-2-f1f2-plots-equivalent-to-the-legacy-eplot-dopoints-tf-doellipse-tf-centroid-tf-.html#f1f2-plots-equivalent-to-the-legacy-eplot...-dopoints-tf-doellipse-tf-centroid-tf-..."><span class="toc-section-number">22.2</span> F1/F2 plots (equivalent to the legacy <code>eplot(..., dopoints = T/F, doellipse = T/F, centroid = T/F, ...)</code>)</a></li>
<li><a href="22-3-f1f2-plot-separated-by-speaker.html#f1f2-plot-separated-by-speaker"><span class="toc-section-number">22.3</span> F1/F2 plot separated by speaker</a></li>
</ul></li>
<li class="has-sub"><a href="23-version-control-of-emudbs-including-collaborative-annotation-with-git-and-gitlab.html#version-control-of-emudbs-including-collaborative-annotation-with-git-and-gitlab"><span class="toc-section-number">23</span> Version control of emuDBs including collaborative annotation with Git and GitLab</a><ul>
<li class="has-sub"><a href="23-1-setup.html#setup"><span class="toc-section-number">23.1</span> Setup</a><ul>
<li><a href="23-1-setup.html#using-gitlab-to-host-the-emudb"><span class="toc-section-number">23.1.1</span> Using GitLab to host the emuDB</a></li>
</ul></li>
<li class="has-sub"><a href="23-2-collaborating-with-others.html#collaborating-with-others"><span class="toc-section-number">23.2</span> Collaborating with others</a><ul>
<li><a href="23-2-collaborating-with-others.html#default-work-flow"><span class="toc-section-number">23.2.1</span> Default work-flow</a></li>
<li><a href="23-2-collaborating-with-others.html#assigning-bundles-to-annotators"><span class="toc-section-number">23.2.2</span> Assigning bundles to annotators</a></li>
<li><a href="23-2-collaborating-with-others.html#pointing-the-emu-webapp-to-the-gitlab-repository"><span class="toc-section-number">23.2.3</span> Pointing the EMU-webApp to the GitLab repository</a></li>
<li><a href="23-2-collaborating-with-others.html#what-about-my-r-scripts-other-files"><span class="toc-section-number">23.2.4</span> What about my R scripts / other files?</a></li>
</ul></li>
</ul></li>
<li><a href="references.html#references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="eql-the-emu-query-language-version-2" class="section level2">
<h2><span class="header-section-number">6.2</span> <code>EQL</code>: The EMU Query Language version 2</h2>
<p>The EQL user interface was retained from the legacy system because it was sufficiently flexible and expressive enough to meet the query needs in most types of speech science research. The EQL parser implemented in <code>emuR</code> is based on the Extended BackusâNaur form (EBNF) <span class="citation">(Garshol <a href="#ref-garshol:2003a" role="doc-biblioref">2003</a>)</span> formal language definition of <span class="citation">John (<a href="#ref-john:2012a" role="doc-biblioref">2012</a>)</span>, which defines the symbols and the relationship of those symbols to each other on which this language is built (see adapted version of entire EBNF in Appendix <a href="17-app-chap-EQL-EBNF.html#app-chap:EQL-EBNF">17</a>). Here we will describe the various terms and components that comprise the slightly adapted version 2 of the EQL. It is worth noting that the new query mechanism uses a relational back-end to handle the various query operations (see Chapter <a href="11-chap-querysys-impl.html#chap:querysys-impl">11</a> for details). This means that expert users, who are proficient in Structured Query Language (SQL) may also query this relational back-end directly. However, we feel the EQL provides a simple abstraction layer which is sufficient for most speech and spoken language research.</p>
<div id="simple-queries" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Simple queries</h3>
<p>The most basic form of an EQL query is a simple equality, inequality, matching or non-matching query, two of which are displayed in R code snippet below. The syntax of a simple query term is <code>[L OPERATOR A]</code>, where <code>L</code> specifies a level (or alternatively the name of a parallel attribute definition); <code>OPERATOR</code> is one of <code>==</code> (equality), <code>!=</code> (inequality), <code>=~</code> (matching) or <code>!~</code> (non-matching); and <code>A</code> is an expression specifying the labels of the annotation items of <code>L</code>.<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a> The second query in the R code snippet below queries an event level. The result of querying an event level contains the same information as that of a segment level query except that the derived end times have the value zero.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb106-1"></a><span class="co"># query all annotation items containing</span></span>
<span id="cb106-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb106-2"></a><span class="co"># the label &quot;m&quot; on the &quot;Phonetic&quot; level</span></span>
<span id="cb106-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb106-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;Phonetic == m&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 m       257.  340. 0fc618~ 0000    msajc~           148         148 Phon~
## 2 m      1490. 1565. 0fc618~ 0000    msajc~           169         169 Phon~
## 3 m       497.  559. 0fc618~ 0000    msajc~           188         188 Phon~
## 4 m      1587. 1656. 0fc618~ 0000    msajc~           149         149 Phon~
## 5 m       819.  903. 0fc618~ 0000    msajc~           120         120 Phon~
## 6 m      1630. 1709. 0fc618~ 0000    msajc~           185         185 Phon~
## 7 m      2173. 2233. 0fc618~ 0000    msajc~           194         194 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb108-1"></a><span class="co"># query all items NOT containing the</span></span>
<span id="cb108-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb108-2"></a><span class="co"># label &quot;H*&quot; on the &quot;Tone&quot; level</span></span>
<span id="cb108-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb108-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;Tone != H*&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 34 x 16
##    labels start   end db_uuid session bundle start_item_id end_item_id level
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
##  1 L-     1107      0 0fc618~ 0000    msajc~           183         183 Tone 
##  2 L-     2543.     0 0fc618~ 0000    msajc~           186         186 Tone 
##  3 L%     2578.     0 0fc618~ 0000    msajc~           187         187 Tone 
##  4 L-     1012.     0 0fc618~ 0000    msajc~           187         187 Tone 
##  5 L-     2459.     0 0fc618~ 0000    msajc~           190         190 Tone 
##  6 L%     2490.     0 0fc618~ 0000    msajc~           191         191 Tone 
##  7 !H*     836.     0 0fc618~ 0000    msajc~           188         188 Tone 
##  8 L-      973.     0 0fc618~ 0000    msajc~           189         189 Tone 
##  9 L-     1558.     0 0fc618~ 0000    msajc~           191         191 Tone 
## 10 !H*    2151.     0 0fc618~ 0000    msajc~           193         193 Tone 
## # ... with 24 more rows, and 7 more variables: attribute &lt;chr&gt;,
## #   start_item_seq_idx &lt;int&gt;, end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;,
## #   sample_start &lt;int&gt;, sample_end &lt;int&gt;, sample_rate &lt;int&gt;</code></pre>
<p>The R code snippet above queries two levels that contain time information: a segment level and an event level. As described in Chapter <a href="4-chap-annot-struct-mod.html#chap:annot-struct-mod">4</a>, annotations in the EMU-SDMS may also contain levels that do not contain time information. The R code snippet below shows a query that queries annotation items on a level that does not contain time information (the <em>Syllable</em> level) to show that the result contains deduced time information from the time-bearing sub-level.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb110-1"></a><span class="co"># query all annotation items containing</span></span>
<span id="cb110-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb110-2"></a><span class="co"># the label S on the Syllable level</span></span>
<span id="cb110-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb110-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;Syllable == S&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 37 x 16
##    labels start   end db_uuid session bundle start_item_id end_item_id level
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
##  1 S       257.  674. 0fc618~ 0000    msajc~           103         103 Syll~
##  2 S       674.  740. 0fc618~ 0000    msajc~           104         104 Syll~
##  3 S       740. 1289. 0fc618~ 0000    msajc~           105         105 Syll~
##  4 S      1791. 1945. 0fc618~ 0000    msajc~           109         109 Syll~
##  5 S      2034. 2284. 0fc618~ 0000    msajc~           111         111 Syll~
##  6 S       572.  798. 0fc618~ 0000    msajc~           107         107 Syll~
##  7 S       798. 1091. 0fc618~ 0000    msajc~           108         108 Syll~
##  8 S      1222. 1391. 0fc618~ 0000    msajc~           110         110 Syll~
##  9 S      1437. 1515. 0fc618~ 0000    msajc~           112         112 Syll~
## 10 S      1628. 1864. 0fc618~ 0000    msajc~           114         114 Syll~
## # ... with 27 more rows, and 7 more variables: attribute &lt;chr&gt;,
## #   start_item_seq_idx &lt;int&gt;, end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;,
## #   sample_start &lt;int&gt;, sample_end &lt;int&gt;, sample_rate &lt;int&gt;</code></pre>
<div id="queries-using-regular-expressions" class="section level4">
<h4><span class="header-section-number">6.2.1.1</span> Queries using regular expressions</h4>
<p>The slightly expanded version 2 of the EQL, which comes with the <code>emuR</code> package, introduces regular expression operators (<code>=~</code> and <code>!~</code>). These allow users to formulate regular expressions for more expressive and precise pattern matching of annotations. A minimal set of examples displaying the new regular expression operators is shown in Table <a href="6-2-eql-the-emu-query-language-version-2.html#tab:eqlExamples">6.1</a>.</p>
<table>
<caption>
<span id="tab:eqlExamples">Table 6.1: </span>EQL V2: examples of simple and complex query strings using RegEx operators including their function descriptions.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Query
</th>
<th style="text-align:left;">
Function
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<code>Phonetic =~ '[AIOUEV]'</code>
</td>
<td style="text-align:left;">
A disjunction of annotations using a RegEx character class
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Word =~ a.*</code>
</td>
<td style="text-align:left;">
All words beginning with <em>a</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>Word !~ .*st</code>
</td>
<td style="text-align:left;">
All words not ending in <em>st</em>
</td>
</tr>
<tr>
<td style="text-align:left;">
<code>[Phonetic == n ^ #Syllable =~ .*]</code>
</td>
<td style="text-align:left;">
All syllables that dominate an n segment of the Phonetic level
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="combining-simple-queries" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Combining simple queries</h3>
<p>The EQL contains three operators that can be used to combine the simple query terms described above as well as position queries which we will describe below. These three operators are the sequence operator, <code>-&gt;</code>; the conjunction operator, <code>&amp;</code>; and the domination operator, <code>^</code>, which is used to perform hierarchical queries. These three types of queries are described below. To start with, we describe the two types of queries that query more complex annotation structures on the same level (sequence and conjunction queries). This is followed by a description of domination queries that query hierarchically linked annotation structures, sometimes spanning multiple annotation levels.</p>
<div id="sequence-queries" class="section level4">
<h4><span class="header-section-number">6.2.2.1</span> Sequence queries</h4>
<p>The syntax of a query string using the <code>-&gt;</code> sequence operator is <code>[L == A -&gt; L == B]</code> where annotation item <code>A</code> on level <code>L</code> precedes item <code>B</code> on level <code>L</code>. For a sequence query to work, both arguments must be on the same level. Alternatively parallel attribute definitions of the same level may also be chosen (see Chapter <a href="4-chap-annot-struct-mod.html#chap:annot-struct-mod">4</a> for further details). An example of a query string using the sequence operator is displayed in the R code snippet below. All rows in the resulting segment list have the start time of <em>@</em>, the end time of <em>n</em> and their labels are <em>@-&gt;n</em>, where the <em>-&gt;</em> substring denotes the sequence.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb112-1"></a><span class="co"># query all sequences of items on the &quot;Phonetic&quot; level</span></span>
<span id="cb112-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb112-2"></a><span class="co"># in which an item containing the label &quot;@&quot; is followed by</span></span>
<span id="cb112-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb112-3"></a><span class="co"># an item containing the label &quot;n&quot;</span></span>
<span id="cb112-4"><a href="6-2-eql-the-emu-query-language-version-2.html#cb112-4"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Phonetic == @ -&gt; Phonetic == n]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 @-&gt;n   1715. 1791. 0fc618~ 0000    msajc~           167         168 Phon~
## 2 @-&gt;n   2382. 2528. 0fc618~ 0000    msajc~           183         184 Phon~
## 3 @-&gt;n   2356. 2475. 0fc618~ 0000    msajc~           181         182 Phon~
## 4 @-&gt;n   2201. 2271. 0fc618~ 0000    msajc~           215         216 Phon~
## 5 @-&gt;n   1422. 1495. 0fc618~ 0000    msajc~           126         127 Phon~
## 6 @-&gt;n   2407. 2480. 0fc618~ 0000    msajc~           198         199 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
</div>
<div id="result-modifier" class="section level4">
<h4><span class="header-section-number">6.2.2.2</span> Result modifier</h4>
<p>Because users are often interested in just one element of a compound query such as sequence queries (e.g., the <em>@</em>s in a <em>@-&gt;n</em> sequences), the EQL offers a so-called result modifier symbol, <code>#</code>. This symbol may be placed in front of any simple query component of a multi component query as depicted in the R code snippet below. Placing the hashtag in front of either the left or the right simple query term will result in segment lists that contain only the annotation items of the simple query term that have the hashtag in front of it. Only one result modifier may be used per query.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb114-1"></a><span class="co"># query the &quot;@&quot;s in &quot;@-&gt;n&quot; sequences</span></span>
<span id="cb114-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb114-2"></a><span class="kw">query</span>(ae, <span class="st">&quot;[#Phonetic == @ -&gt; Phonetic == n]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 @      1715. 1741. 0fc618~ 0000    msajc~           167         167 Phon~
## 2 @      2382. 2431. 0fc618~ 0000    msajc~           183         183 Phon~
## 3 @      2356. 2402. 0fc618~ 0000    msajc~           181         181 Phon~
## 4 @      2201. 2227. 0fc618~ 0000    msajc~           215         215 Phon~
## 5 @      1422. 1435. 0fc618~ 0000    msajc~           126         126 Phon~
## 6 @      2407. 2448. 0fc618~ 0000    msajc~           198         198 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb116-1"></a><span class="co"># query the &quot;n&quot;s in a &quot;@-&gt;n&quot; sequences</span></span>
<span id="cb116-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb116-2"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Phonetic == @ -&gt; #Phonetic == n]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 n      1741. 1791. 0fc618~ 0000    msajc~           168         168 Phon~
## 2 n      2431. 2528. 0fc618~ 0000    msajc~           184         184 Phon~
## 3 n      2402. 2475. 0fc618~ 0000    msajc~           182         182 Phon~
## 4 n      2227. 2271. 0fc618~ 0000    msajc~           216         216 Phon~
## 5 n      1435. 1495. 0fc618~ 0000    msajc~           127         127 Phon~
## 6 n      2448. 2480. 0fc618~ 0000    msajc~           199         199 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
</div>
<div id="conjunction-queries" class="section level4">
<h4><span class="header-section-number">6.2.2.3</span> Conjunction queries</h4>
<p>The syntax of a query string using the conjunction operator can schematically be written as: <code>[L_a1 == A &amp; L_a2 == B &amp; L_a3 == C &amp; L_a4 == D &amp; ... &amp; L_an == N]</code>, where annotation items on level <code>L</code> have the label <code>A</code> and also have the parallel labels <code>B</code>, <code>C</code>, <code>D</code>, â¦, <code>N</code> (see Chapter <a href="4-chap-annot-struct-mod.html#chap:annot-struct-mod">4</a> for more information about parallel labels). By analogy with the sequence operator, all simple query statements must refer to the same level (i.e., only parallel attributes definitions of the same level indicated by the <code>a1 - an</code> may to be chosen). Hence, the conjunction operator is used to combine query conditions on the same level. Using the conjunction operator is useful for two reasons:</p>
<ul>
<li>It combines different attributes of the same level: <code>[Text == always &amp; Accent == S]</code> where <em>Text</em> and <em>Accent</em> are additional attributes of level <em>Word</em>; and</li>
<li>It combines a simple query with a function query (see Position Queries Section <a href="6-2-eql-the-emu-query-language-version-2.html#subsec:query-positionQueries">6.2.3</a>): <em>[Phonetic == l &amp; Start(Word, Phonetic) == 1]</em>.</li>
</ul>
<p>An example of a query string using the conjunction operator is displayed in the R code snippet below.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb118-1"></a><span class="co"># query all words with the orthographic transcription &quot;always&quot;</span></span>
<span id="cb118-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb118-2"></a><span class="co"># that also have a strong word accent (&quot;S&quot;)</span></span>
<span id="cb118-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb118-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Text == always &amp; Accent == S]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 always  775. 1280. 0fc618~ 0000    msajc~            28          28 Word 
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<p>The above R code snippet does not make use of the result modifier symbol. However, only the annotation items of the left simple query term (<em>Text == always</em>) are returned. This behavior is true for all EQL operators that combine simple query terms except for the sequence operator. As it is more explicit to use the result modifier to express the desired result, we recommend using the result modifier where possible. The more explicit variant of the above query which yields the same result is <em>â[#Text == always &amp; Word == C]â</em>.</p>
</div>
<div id="subsubsec:query-dominationQueries" class="section level4">
<h4><span class="header-section-number">6.2.2.4</span> Domination/hierarchical queries</h4>
<p>Compared to sequence and conjunction queries, a domination query using the operator <em>^</em> is not bound to a single level. Instead, it allows users to query annotation items that are directly or indirectly linked over one or more levels. Queries using the domination operator are often referred to as hierarchical queries as they provide the ability to query the hierarchical annotations in a vertical or inter-level manner. Figure <a href="6-2-eql-the-emu-query-language-version-2.html#fig:amongstHierDomintation">6.2</a> shows the same partial hierarchy as Figure <a href="6-chap-querysys.html#fig:amongstHier">6.1</a> but highlights the annotational items that are dominated by the strong syllable (<em>S</em>) of the <em>Syllable</em> level. Such linked hierarchical sub-structures can be queried using hierarchical/domination queries.</p>
<div class="figure" style="text-align: center"><span id="fig:amongstHierDomintation"></span>
<img src="pics/amongstHierDomination.png" alt="Partial hierarchy depicting all annotation items that are dominated by the strong syllable (*S*) of the *Syllable* level (inside dashed box). Items marked green belong to the *Phoneme* level, items marked orange belong to the *Phonetic* level and the purple dashed box indicates the set of items that are dominated by *S*." width="75%" />
<p class="caption">
Figure 6.2: Partial hierarchy depicting all annotation items that are dominated by the strong syllable (<em>S</em>) of the <em>Syllable</em> level (inside dashed box). Items marked green belong to the <em>Phoneme</em> level, items marked orange belong to the <em>Phonetic</em> level and the purple dashed box indicates the set of items that are dominated by <em>S</em>.
</p>
</div>
<p>A schematic representation of a simple domination query string that retrieves all annotation items <em>A</em> of level <code>L1</code> that are dominated by items <code>B</code> in level <code>L2</code> (i.e., items that are directly or indirectly linked) is <code>[L1 == A ^  L2 == B]</code>. Although the domination relationship is directed the domination operator is not. This means that either items in <code>L1</code> dominate items in <code>L2</code> or items in <code>L2</code> dominate items in <code>L1</code>. Note that link definitions that specify the validity of the domination have to be present in the <code>emuDB</code> configuration for this to work (see Chapter <a href="5-chap-emuDB.html#chap:emuDB">5</a> for details). An example of a query string using the domination operator is displayed in the R code snippet below.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb120-1"></a><span class="co"># query all &quot;p&quot; phoneme items that belong</span></span>
<span id="cb120-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb120-2"></a><span class="co"># to / are dominated by a strong syllable (&quot;S&quot;)</span></span>
<span id="cb120-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb120-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Phoneme == p ^ Syllable == S]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 p       559.  640. 0fc618~ 0000    msajc~           147         147 Phon~
## 2 p      1656. 1699. 0fc618~ 0000    msajc~           122         122 Phon~
## 3 p       864.  970. 0fc618~ 0000    msajc~           136         136 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<p>As with the conjunction query, if no result modifier is present, a dominates query returns the annotation items of the left simple query term. Hence, the more explicit variant of the above query is <code>"[#Phoneme == p ^ Syllable == S]"</code>.</p>
</div>
</div>
<div id="subsec:query-positionQueries" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Position queries</h3>
<p>The EQL has three function terms that specify where in a domination relationship a child level annotation item is allowed to occur. The three function terms are <code>Start()</code>, <code>End()</code> and <code>Medial()</code>. A schematic representation of a query string representing a simple usage of the <code>Start()</code>, <code>End()</code> and <code>Medial()</code> function would be: <code>POSFCT(L1, L2) == TRUE</code>. In this representation <code>POSFCT</code> is a placeholder for one of the three functions, at which level <code>L1</code> must dominate level <code>L2</code>. Where <code>L1</code> does indeed dominate <code>L2</code>, the corresponding item from level <code>L2</code> is returned. If the expression is set to <code>FALSE</code> (i.e., <code>POSFCT(L1, L2) == FALSE</code>), all the items that do not match the condition of <code>L2</code> are returned. An illustration of what is returned by each of the position functions depending on if they are set to <code>TRUE</code> or <code>FALSE</code> is depicted in Figure <a href="6-2-eql-the-emu-query-language-version-2.html#fig:query-positionSimple">6.3</a>, while the R code snippet below shows an example query using a position query term.</p>
<div class="figure" style="text-align: center"><span id="fig:query-positionSimple"></span>
<img src="pics/positionSimple.png" alt="Illustration of what is returned by the `Start()`, `Medial()` and `End()` functions depending if they are set to **A:** `TRUE` (green) or **B:** `FALSE` (orange)." width="75%" />
<p class="caption">
Figure 6.3: Illustration of what is returned by the <code>Start()</code>, <code>Medial()</code> and <code>End()</code> functions depending if they are set to <strong>A:</strong> <code>TRUE</code> (green) or <strong>B:</strong> <code>FALSE</code> (orange).
</p>
</div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb122-1"></a><span class="co"># query all phoneme items that occur</span></span>
<span id="cb122-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb122-2"></a><span class="co"># at the start of a syllable</span></span>
<span id="cb122-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb122-3"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Start(Syllable, Phoneme) == TRUE]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 83 x 16
##    labels start   end db_uuid session bundle start_item_id end_item_id level
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
##  1 V       187.  257. 0fc618~ 0000    msajc~           114         114 Phon~
##  2 m       257.  340. 0fc618~ 0000    msajc~           115         115 Phon~
##  3 @:      674.  740. 0fc618~ 0000    msajc~           120         120 Phon~
##  4 f       740.  893. 0fc618~ 0000    msajc~           121         121 Phon~
##  5 S      1289. 1420. 0fc618~ 0000    msajc~           126         126 Phon~
##  6 w      1463. 1506. 0fc618~ 0000    msajc~           128         128 Phon~
##  7 k      1634. 1715. 0fc618~ 0000    msajc~           131         131 Phon~
##  8 s      1791. 1893. 0fc618~ 0000    msajc~           134         134 Phon~
##  9 d      1945. 1967. 0fc618~ 0000    msajc~           136         136 Phon~
## 10 b      2034. 2150. 0fc618~ 0000    msajc~           139         139 Phon~
## # ... with 73 more rows, and 7 more variables: attribute &lt;chr&gt;,
## #   start_item_seq_idx &lt;int&gt;, end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;,
## #   sample_start &lt;int&gt;, sample_end &lt;int&gt;, sample_rate &lt;int&gt;</code></pre>
</div>
<div id="subsec:query-countQueries" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Count queries</h3>
<p>A further query component of the EQL are so-called count queries. They allow the user to specify how many child nodes a parent annotation item is allowed to have. Figure <a href="6-2-eql-the-emu-query-language-version-2.html#fig:query-amongstHierCount">6.4</a> displays two syllables, one containing one phoneme and one phonetic annotation item, the other containing five phoneme and six phonetic items. Using EQLâs <code>Num()</code> function it is possible to specify which of the two syllables should be retrieved, depending on the number of phonemic or phonetic elements to which it is directly or indirectly linked. The R code snippet below shows a query that queries all syllables that contain five phonemes.</p>
<div class="figure" style="text-align: center"><span id="fig:query-amongstHierCount"></span>
<img src="pics/amongstHierCount.png" alt="Partial hierarchy depicting a *Syllable* containing one *Phoneme* and  *Phonetic* item (green) and a *Syllable* containing five *Phoneme* and six *Phonetic* items (orange)." width="75%" />
<p class="caption">
Figure 6.4: Partial hierarchy depicting a <em>Syllable</em> containing one <em>Phoneme</em> and <em>Phonetic</em> item (green) and a <em>Syllable</em> containing five <em>Phoneme</em> and six <em>Phonetic</em> items (orange).
</p>
</div>
<p>A schematic representation of a query string utilizing the count mechanism would be <code>[Num(L1, L2) == N]</code>, where <code>L1</code> contains <code>N</code> annotation items in <code>L2</code>. For this type of query to work <code>L1</code> has to dominate <code>L2</code> (i.e., be a parent level to <code>L2</code>). As the query matches a number (<code>N</code>), it is also possible to use the operators <code>&gt;</code> (more than), <code>&lt;</code> (less than) and <code>!=</code> (not equal to). The resulting segment list contains items of <code>L1</code>.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb124-1"></a><span class="co"># retrieve all syllables that contain five phonemes</span></span>
<span id="cb124-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb124-2"></a><span class="kw">query</span>(ae, <span class="st">&quot;[Num(Syllable, Phoneme) == 5]&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 S       257.  674. 0fc618~ 0000    msajc~           103         103 Syll~
## 2 S       740. 1289. 0fc618~ 0000    msajc~           105         105 Syll~
## 3 W      2228. 2754. 0fc618~ 0000    msajc~           118         118 Syll~
## 4 S      1890. 2470. 0fc618~ 0000    msajc~           105         105 Syll~
## 5 S      1964. 2554. 0fc618~ 0000    msajc~            90          90 Syll~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
</div>
<div id="subsec:query-moreComplexQueries" class="section level3">
<h3><span class="header-section-number">6.2.5</span> More complex queries</h3>
<p>By using the correct bracketing, all of the above query components can be combined to formulate more complex queries that can be used to answer questions such as: <em>Which occurrences of the word âhisâ follow three-syllable words which contain a schwa (@) in the first syllable?</em> Such multi-part questions can usually be broken down into several sub-queries. These sub-queries can then be recombined to formulate the complex query. The steps to answering the above multi-part question are:</p>
<ol style="list-style-type: decimal">
<li><em>Which occurrences of the word âhisâ â¦</em>: <code>[Text == his]</code></li>
<li><em>â¦ three-syllable words â¦</em>: <code>[Num(Text, Syllable) == 3]</code></li>
<li><em>â¦ contain a schwa (@) in the first syllable â¦</em>: <code>[Phoneme == @ ^ Start(Word, Syllable) == 1]</code></li>
<li>All three can be combined by saying 2 dominates 3 (<code>[2 ^ 3]</code>) and these are followed by 1 (<code>[2 ^ 3] -&gt; 1]</code>)</li>
</ol>
<p>The combine query is depicted in the R code snippet below. This complex query demonstrates the expressive power of the query mechanism that the EMU-SDMS provides.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-1"></a><span class="co"># perform complex query</span></span>
<span id="cb126-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-2"></a><span class="co"># Note that the use of paste0() is optional, as</span></span>
<span id="cb126-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-3"></a><span class="co"># it is only used for formatting purposes</span></span>
<span id="cb126-4"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-4"></a><span class="kw">query</span>(ae, <span class="kw">paste0</span>(<span class="st">&quot;[[[Num(Text, Syllable) == 3] &quot;</span>,</span>
<span id="cb126-5"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-5"></a>                 <span class="st">&quot;^ [Phoneme == @ ^ Start(Word, Syllable) == 1]] &quot;</span>,</span>
<span id="cb126-6"><a href="6-2-eql-the-emu-query-language-version-2.html#cb126-6"></a>                 <span class="st">&quot;-&gt; #Text = his]&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 his    2694. 2781. 0fc618~ 0000    msajc~           101         101 Word 
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<p>As mastering these complex compound queries can require some practice, several simple as well as more complex examples that combine the various EQL components described above are available in Appendix <a href="18-app-chap-eql.html#app-chap:eql">18</a>. These examples provide practical examples to help users find queries suited to their needs.</p>
</div>
<div id="subsec:query-deducingTime" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Deducing time</h3>
<p>The default behavior of the legacy EMU system was to automatically deduce time information for queries of levels that do not contain time information. This was achieved by searching for the time-bearing sub-level and calculating the start and end times from the left-most and right-most annotation items which where directly or indirectly linked to the retrieved parent item. This upward purculation of time information is also the default behavior of the new EMU-SDMS. However, a new feature has been added to the query engine which allows the calculation of time to be switched off for a given query using the <code>calcTimes</code> parameter of the <code>query()</code> function. This is beneficial in two ways: for one, levels that do not have a time-bearing sub-level may be queried and secondly, the execution time of queries can be greatly improved. The performance increase becomes evident when performing queries on large data sets on one of the top levels of the hierarchy (e.g., <em>Utterance</em> or <em>Intonational</em> in the <em>ae</em> <code>emuDB</code>). When deducing time information for annotation items that contain large portions of the hierarchy, the query engine has to walk down large partial hierarchies to find the left-most and right-most items on the time-bearing sub-level. This can be a computationally expensive operation and is often unnecessary, especially during data exploration. The R code snippet below shows the usage of this parameter by querying all of the items of the <em>Intonational</em> level and displaying the <code>NA</code> values for start and end times in the resulting segment list. It is worth noting that the missing time information excluded during the original query can be retrieved at a later point in time by performing a hierarchical requery (see Section <a href="6-2-eql-the-emu-query-language-version-2.html#subsec:requery">6.2.7</a>) on the same level.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb128-1"></a><span class="co"># query all intonational items</span></span>
<span id="cb128-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb128-2"></a><span class="kw">query</span>(ae, <span class="st">&quot;Intonational =~ .*&quot;</span>, <span class="dt">calcTimes =</span> F)</span></code></pre></div>
<pre><code>## # A tibble: 7 x 16
##   labels start   end db_uuid session bundle start_item_id end_item_id level
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
## 1 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 2 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 3 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 4 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 5 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 6 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## 7 L%        NA    NA 0fc618~ 0000    msajc~             7           7 Into~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
</div>
<div id="subsec:requery" class="section level3">
<h3><span class="header-section-number">6.2.7</span> Requery</h3>
<p>A popular feature of the legacy system was the ability to use the result of a query to perform an additional query, called a requery, starting from the resulting items of a query. The requery functionality was used to move either sequentially (horizontally) or hierarchically (vertically) through the hierarchical annotation structure. Although this feature technically does not extend the querying functionality (it is possible to formulate EQL queries that yield the same results as a query followed by <span class="math inline">\(1:n\)</span> requeries), requeries benefit the user by breaking down the task of formulating long query terms into multiple, simpler queries. Compared with the legacy system, this feature is implemented in the <code>emuR</code> package in a more robust way, as unique item IDs are present in the result of a query, eliminating the need for searching the starting segments based on their time information. Examples of queries and their results within a hierarchical annotation based on a hierarchical and sequential requery as well as their EQL equivalents are illustrated in Figure <a href="6-2-eql-the-emu-query-language-version-2.html#fig:query-requery">6.5</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:query-requery"></span>
<img src="pics/requery.png" alt="Three-step (query (green) -&gt; requery_hier (orange) -&gt; requery_seq (purple)) requery procedure, its single query (grey) counterpart and their color coded movements within the annotation hierarchy." width="75%" />
<p class="caption">
Figure 6.5: Three-step (query (green) -&gt; requery_hier (orange) -&gt; requery_seq (purple)) requery procedure, its single query (grey) counterpart and their color coded movements within the annotation hierarchy.
</p>
</div>
<p>The R code snippet below illustrates how the same results of the sequential query <code>[#Phonetic =~ .* -&gt; Phonetic == n]</code> can be achieved using the <code>requery_seq()</code> function. Further, it shows how the <code>requery_hier()</code> function can be used to move vertically through the annotation structure by starting at the <em>Syllable</em> level and retrieving all the <em>Phonetic</em> items for the query result.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-1"></a><span class="co">########################</span></span>
<span id="cb130-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-2"></a><span class="co"># requery_seq()</span></span>
<span id="cb130-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-3"></a></span>
<span id="cb130-4"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-4"></a><span class="co"># query all &quot;n&quot; phonetic items</span></span>
<span id="cb130-5"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-5"></a>sl_n =<span class="st"> </span><span class="kw">query</span>(ae, <span class="st">&quot;Phonetic == n&quot;</span>)</span>
<span id="cb130-6"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-6"></a></span>
<span id="cb130-7"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-7"></a><span class="co"># sequential requery (left shift result by 1 (== offset of -1))</span></span>
<span id="cb130-8"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-8"></a><span class="co"># and hence retrieve all phonetic items directly preceeding</span></span>
<span id="cb130-9"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-9"></a><span class="co"># all &quot;n&quot; phonetic items</span></span>
<span id="cb130-10"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-10"></a><span class="kw">requery_seq</span>(ae, </span>
<span id="cb130-11"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-11"></a>            <span class="dt">seglist =</span> sl_n, </span>
<span id="cb130-12"><a href="6-2-eql-the-emu-query-language-version-2.html#cb130-12"></a>            <span class="dt">offset =</span> <span class="dv">-1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 16
##    labels start   end db_uuid session bundle start_item_id end_item_id level
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
##  1 E       950. 1032. 0fc618~ 0000    msajc~           157         157 Phon~
##  2 @      1715. 1741. 0fc618~ 0000    msajc~           167         167 Phon~
##  3 E      1437. 1515. 0fc618~ 0000    msajc~           169         169 Phon~
##  4 @      2382. 2431. 0fc618~ 0000    msajc~           183         183 Phon~
##  5 I       812.  895. 0fc618~ 0000    msajc~           157         157 Phon~
##  6 @      2356. 2402. 0fc618~ 0000    msajc~           181         181 Phon~
##  7 @      2201. 2227. 0fc618~ 0000    msajc~           215         215 Phon~
##  8 H      3027. 3046. 0fc618~ 0000    msajc~           228         228 Phon~
##  9 @      1422. 1435. 0fc618~ 0000    msajc~           126         126 Phon~
## 10 k      1705. 1775. 0fc618~ 0000    msajc~           131         131 Phon~
## 11 On      476.  509. 0fc618~ 0000    msajc~           165         165 Phon~
## 12 @      2407. 2448. 0fc618~ 0000    msajc~           198         198 Phon~
## # ... with 7 more variables: attribute &lt;chr&gt;, start_item_seq_idx &lt;int&gt;,
## #   end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;, sample_start &lt;int&gt;, sample_end &lt;int&gt;,
## #   sample_rate &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-1"></a><span class="co">########################</span></span>
<span id="cb132-2"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-2"></a><span class="co"># requery_hier()</span></span>
<span id="cb132-3"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-3"></a></span>
<span id="cb132-4"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-4"></a><span class="co"># query all strong syllables (S)</span></span>
<span id="cb132-5"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-5"></a>sl_s =<span class="st"> </span><span class="kw">query</span>(ae, <span class="st">&quot;Syllable == S&quot;</span>)</span>
<span id="cb132-6"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-6"></a></span>
<span id="cb132-7"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-7"></a><span class="co"># hierarchical requery</span></span>
<span id="cb132-8"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-8"></a><span class="kw">requery_hier</span>(ae, </span>
<span id="cb132-9"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-9"></a>             <span class="dt">seglist =</span> sl_s,</span>
<span id="cb132-10"><a href="6-2-eql-the-emu-query-language-version-2.html#cb132-10"></a>             <span class="dt">level =</span> <span class="st">&quot;Phonetic&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 37 x 16
##    labels start   end db_uuid session bundle start_item_id end_item_id level
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;       &lt;int&gt; &lt;chr&gt;
##  1 m-&gt;V-~  257.  674. 0fc618~ 0000    msajc~           148         153 Phon~
##  2 @:      674.  740. 0fc618~ 0000    msajc~           154         154 Phon~
##  3 f-&gt;r-~  740. 1289. 0fc618~ 0000    msajc~           155         159 Phon~
##  4 s-&gt;I   1791. 1945. 0fc618~ 0000    msajc~           169         170 Phon~
##  5 db-&gt;j~ 2034. 2284. 0fc618~ 0000    msajc~           173         175 Phon~
##  6 f-&gt;j-~  572.  798. 0fc618~ 0000    msajc~           156         158 Phon~
##  7 t-&gt;H-~  798. 1091. 0fc618~ 0000    msajc~           159         162 Phon~
##  8 O-&gt;f   1222. 1391. 0fc618~ 0000    msajc~           166         167 Phon~
##  9 E      1437. 1515. 0fc618~ 0000    msajc~           169         169 Phon~
## 10 f-&gt;@:  1628. 1864. 0fc618~ 0000    msajc~           172         173 Phon~
## # ... with 27 more rows, and 7 more variables: attribute &lt;chr&gt;,
## #   start_item_seq_idx &lt;int&gt;, end_item_seq_idx &lt;int&gt;, type &lt;chr&gt;,
## #   sample_start &lt;int&gt;, sample_end &lt;int&gt;, sample_rate &lt;int&gt;</code></pre>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-garshol:2003a">
<p>Garshol, Lars Marius. 2003. âBNF and EBNF: What Are They and How Do They Work.â <em>Acedida Pela Ãºltima Vez Em</em> 16.</p>
</div>
<div id="ref-john:2012a">
<p>John, Tina. 2012. âEmu Speech Database System.â PhD thesis, Ludwig Maximilian University of Munich.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="13">
<li id="fn13"><p>The examples and syntax descriptions used in this chapter have been adapted from examples by <span class="citation">Cassidy and Harrington (<a href="#ref-cassidy:sc2001a" role="doc-biblioref">2001</a>)</span> and <span class="citation">Harrington and Cassidy (<a href="#ref-harrington:2002aa" role="doc-biblioref">2002</a>)</span> and were largely extracted from the <code>EQL</code> vignette of the <code>emuR</code> package. All of the examples were adapted to work with the supplied <em>ae</em> <code>emuDB</code>.<a href="6-2-eql-the-emu-query-language-version-2.html#fnref13" class="footnote-back">â©ï¸</a></p></li>
</ol>
</div>
<p style="text-align: center;">
<a href="6-1-sec-query-emuRsegs.html"><button class="btn btn-default">Previous</button></a>
<a href="https://github.com/IPS-LMU/The-EMU-SDMS-Manual/edit/master/query.Rmd"><button class="btn btn-default">Edit</button></a>
<a href="6-3-discussion.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
